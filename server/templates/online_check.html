{% extends "base.html" %}{% block content %}<div class="row justify-content-center mt-4"><div class="col-md-10"><div class="card card-custom mb-4"><div class="card-body pt-3"><h5 class="fw-bold mb-3"><i class="fas fa-book-open me-2 text-primary"></i>使用教學</h5><ol class="mb-0 text-muted" style="line-height: 1.8;"><li>點擊下方區塊選擇照片，或直接<strong>拖曳照片</strong>至框框內 (JPG/PNG)。</li><li>系統會自動計算雜湊值比對重複內容。</li><li>檢查結果會顯示上傳的<strong>原始檔案名稱</strong>。</li><li>點擊結果圖片可開啟<strong>放大鏡檢視</strong>。</li><li>每個帳號每 5 分鐘最多上傳 20 張照片做判斷。</li><li class="text-danger">本系統不永久儲存照片！每 15 分鐘系統會自動清除暫存檔，以節省伺服器空間。</li></ol></div></div><div class="card card-custom p-5 border-dashed border-2 text-center upload-area" onclick="document.getElementById('fileInput').click();" ondragover="event.preventDefault(); this.style.backgroundColor='rgba(78,115,223,0.2)';" ondragleave="this.style.backgroundColor='rgba(78,115,223,0.05)';" ondrop="event.preventDefault(); this.style.backgroundColor='rgba(78,115,223,0.05)'; document.getElementById('fileInput').files = event.dataTransfer.files; document.getElementById('uploadForm').submit();"><div class="card-body"><form id="uploadForm" method="POST" enctype="multipart/form-data"><div class="mb-4"><i class="fas fa-cloud-upload-alt fa-3x text-primary"></i></div><h4 class="mb-2">拖曳或點擊上傳照片</h4><p class="text-muted small">支援 JPG / PNG，單次限 20 張</p><input type="file" id="fileInput" class="d-none" name="files" multiple accept=".png, .jpg, .jpeg" onchange="document.getElementById('uploadForm').submit();"><button type="button" class="btn btn-primary btn-lg px-5 rounded-pill shadow" onclick="document.getElementById('fileInput').click();">選擇檔案</button></form></div></div>{% if duplicates %}<h3 class="fw-bold text-danger mb-4"><i class="fas fa-exclamation-circle me-2"></i>發現重複群組</h3>{% for hash_val, file_list in duplicates.items() %}<div class="duplicate-group border border-danger p-3 rounded mb-3 bg-white"><h5 class="fw-bold mb-3 text-danger">重複群組 #{{ loop.index }}</h5><div class="row g-3">{% for file_obj in file_list %}<div class="col-md-3 col-6"><div class="card border shadow-sm preview-card"><img src="{{ url_for('static', filename='uploads/' + file_obj.storage) }}" class="card-img-top" style="height: 150px; object-fit: cover;" onclick="showImage(this.src, '{{ file_obj.display }}')"><div class="card-footer bg-white p-2"><small class="d-block filename-text" title="{{ file_obj.display }}">{{ file_obj.display }}</small></div></div></div>{% endfor %}</div></div>{% endfor %}{% endif %}</div></div>{% if scan_complete %}<div class="modal fade" id="scanResultModal" tabindex="-1"><div class="modal-dialog modal-dialog-centered"><div class="modal-content"><div class="modal-header {{ 'bg-danger text-white' if duplicates else 'bg-success text-white' }}"><h5 class="modal-title fw-bold">{% if duplicates %}<i class="fas fa-exclamation-triangle me-2"></i>掃描完成！發現重複{% else %}<i class="fas fa-check-circle me-2"></i>掃描完成！無重複{% endif %}</h5><button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button></div><div class="modal-body text-center py-4">{% if duplicates %}<h4 class="text-danger fw-bold">共發現 {{ duplicates|length }} 組重複照片</h4><p class="text-muted">請往下滑動查看詳細比對結果。</p>{% else %}<h4 class="text-success fw-bold">恭喜！</h4><p class="text-muted">您上傳的照片中沒有發現任何重複內容。</p>{% endif %}</div><div class="modal-footer"><button type="button" class="btn btn-secondary" data-bs-dismiss="modal">關閉</button></div></div></div></div><script>document.addEventListener("DOMContentLoaded", function(){var myModal = new bootstrap.Modal(document.getElementById('scanResultModal'));myModal.show();});</script>{% endif %}<div class="modal fade" id="imageZoomModal" tabindex="-1"><div class="modal-dialog modal-dialog-centered modal-lg"><div class="modal-content bg-dark"><div class="modal-header border-0"><h6 class="modal-title text-white" id="zoomModalTitle"></h6><button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button></div><div class="modal-body text-center p-0"><div class="zoom-container" id="zoomContainer" onmousemove="zoom(event)" onmouseleave="resetZoom()"><img id="zoomedImage" src=""></div></div></div></div></div><script>function showImage(src, filename) {document.getElementById('zoomedImage').src = src;document.getElementById('zoomModalTitle').innerText = filename;var zoomModal = new bootstrap.Modal(document.getElementById('imageZoomModal'));zoomModal.show();} function zoom(e) {var zoomer = e.currentTarget; var img = zoomer.querySelector('img'); var offsetX = e.offsetX; var offsetY = e.offsetY; var x = offsetX / zoomer.offsetWidth * 100; var y = offsetY / zoomer.offsetHeight * 100; img.style.transformOrigin = x + '% ' + y + '%'; img.style.transform = 'scale(2.5)';} function resetZoom() {var img = document.getElementById('zoomedImage'); img.style.transform = 'scale(1)';}</script>{% endblock %}